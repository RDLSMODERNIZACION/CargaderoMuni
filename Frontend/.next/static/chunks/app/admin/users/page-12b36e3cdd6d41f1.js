(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{5238:function(e,t,s){Promise.resolve().then(s.bind(s,3058))},3058:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),n=s(2265),l=s(8597),i=s(9869),r=s(6809),d=s(3448),c=s(9725),o=s(9617);function u(){let[e,t]=(0,n.useState)(l.rC),[s,u]=(0,n.useState)(""),[h,x]=(0,n.useState)(""),[m,p]=(0,n.useState)(null),b=(0,n.useMemo)(()=>{var t;return null!==(t=e.find(e=>e.id===m))&&void 0!==t?t:null},[e,m]),_=(0,n.useMemo)(()=>e.filter(e=>{let t=!s||e.name.toLowerCase().includes(s.toLowerCase()),a=""===h||("enabled"===h?e.enabled:"disabled"===h?!e.enabled:"locked"!==h||!!e.locked_until);return t&&a}),[e,s,h]),j=e=>p(t=>t===e?e:t),f=(e,s)=>t(t=>t.map(t=>t.id===e?{...t,...s}:t)),g=t=>{let s=e.find(e=>e.id===t);s&&(f(t,{enabled:!s.enabled}),j(t))},v=e=>{f(e,{tries:0}),j(e)},N=e=>{f(e,{locked_until:new Date(Date.now()+864e5).toISOString()}),j(e)},k=e=>{f(e,{locked_until:null}),j(e)},[y,C]=(0,n.useState)(function(){let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}()),Z=(0,n.useMemo)(()=>{if(!b)return[];let{start:e,end:t}=function(e){let[t,s]=e.split("-").map(Number);return{start:new Date(Date.UTC(t,(null!=s?s:1)-1,1,0,0,0)),end:new Date(Date.UTC(t,null!=s?s:1,1,0,0,0))}}(y);return l.hp.filter(s=>{if(s.pin_user_id!==b.id)return!1;let a=new Date(s.started_at);return a>=e&&a<t})},[b,y]),T=Z.length,w=Z.reduce((e,t)=>e+t.litros_entregados,0);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Usuarios PIN"}),(0,a.jsx)("section",{className:"card",children:(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500",children:"Buscar"}),(0,a.jsx)("input",{className:"input",placeholder:"Nombre...",value:s,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500",children:"Estado"}),(0,a.jsxs)("select",{className:"select",value:h,onChange:e=>x(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Todos"}),(0,a.jsx)("option",{value:"enabled",children:"Habilitados"}),(0,a.jsx)("option",{value:"disabled",children:"Inhabilitados"}),(0,a.jsx)("option",{value:"locked",children:"Bloqueados"})]})]})]})}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)(i.Z,{rows:_,columns:[{key:"id",header:"ID",width:"60px"},{key:"name",header:"Nombre"},{key:"enabled",header:"Estado",render:e=>(0,a.jsx)(r.Z,{color:e.enabled?"green":"red",children:e.enabled?"Habilitado":"Inhabilitado"})},{key:"tries",header:"Intentos"},{key:"locked_until",header:"Bloqueado hasta",render:e=>e.locked_until?(0,d.G$)(e.locked_until):"—"},{key:"created_at",header:"Creado",render:e=>(0,d.G$)(e.created_at)}],initialSortKey:"name",initialSortDir:"asc",onRowClick:e=>p(e.id),rowClassName:e=>m===e.id?"bg-sky-50":""}),(0,a.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:"Tip: hac\xe9 click en una fila para ver acciones y facturaci\xf3n."})]}),(0,a.jsx)(c.Z,{open:!!b,onClose:()=>p(null),title:b?"Usuario \xb7 ".concat(b.name):"",children:b&&(0,a.jsx)(o.Z,{defaultTab:"acciones",tabs:[{key:"acciones",label:"Acciones",content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Estado"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(r.Z,{color:b.enabled?"green":"red",children:b.enabled?"Habilitado":"Inhabilitado"}),(0,a.jsx)("span",{className:"text-slate-500",children:"\xb7"}),(0,a.jsxs)("span",{children:["Intentos: ",(0,a.jsx)("b",{children:b.tries})]}),(0,a.jsx)("span",{className:"text-slate-500",children:"\xb7"}),(0,a.jsxs)("span",{children:["Bloqueado hasta: ",(0,a.jsx)("b",{children:b.locked_until?(0,d.G$)(b.locked_until):"—"})]})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"Acciones r\xe1pidas"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{className:"btn",onClick:()=>g(b.id),children:b.enabled?"Inhabilitar":"Habilitar"}),(0,a.jsx)("button",{className:"btn",onClick:()=>v(b.id),children:"Reset intentos"}),b.locked_until?(0,a.jsx)("button",{className:"btn",onClick:()=>k(b.id),children:"Desbloquear"}):(0,a.jsx)("button",{className:"btn",onClick:()=>N(b.id),children:"Bloquear 24 h"})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-slate-500",children:"* Demo: los cambios son locales y se pierden al refrescar."})]})]})},{key:"facturacion",label:"Facturaci\xf3n",badge:(0,a.jsx)("span",{className:"badge bg-slate-100 text-slate-700",children:Z.length}),content:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500",children:"Mes"}),(0,a.jsx)("input",{type:"month",className:"input",value:y,onChange:e=>C(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500",children:"Cantidad de cargas"}),(0,a.jsx)("div",{className:"h-9 flex items-center",children:T})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-500",children:"Litros entregados"}),(0,a.jsx)("div",{className:"h-9 flex items-center",children:(0,d.Cl)(w)})]})]})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Cargas del per\xedodo"}),(0,a.jsx)("button",{className:"btn",onClick:()=>{if(!b)return;let e=new Blob([["dispatch_id,fecha_inicio,fecha_fin,estacion,autorizados_l,entregados_l,estado,notas",...Z.map(e=>{var t;return[e.id,new Date(e.started_at).toISOString(),e.ended_at?new Date(e.ended_at).toISOString():"",e.station_name,e.litros_autorizados,e.litros_entregados,e.status,(null!==(t=e.notes)&&void 0!==t?t:"").replaceAll(","," ")].join(",")})].join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="facturacion_".concat(b.name,"_").concat(y,".csv"),s.click(),URL.revokeObjectURL(t)},children:"Descargar CSV"})]}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Inicio"}),(0,a.jsx)("th",{children:"Fin"}),(0,a.jsx)("th",{children:"Estaci\xf3n"}),(0,a.jsx)("th",{children:"Autorizados"}),(0,a.jsx)("th",{children:"Entregados"})]})}),(0,a.jsxs)("tbody",{children:[Z.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsx)("td",{children:e.id}),(0,a.jsx)("td",{children:(0,d.G$)(e.started_at)}),(0,a.jsx)("td",{children:(0,d.G$)(e.ended_at)}),(0,a.jsx)("td",{children:e.station_name}),(0,a.jsx)("td",{children:(0,d.Cl)(e.litros_autorizados)}),(0,a.jsx)("td",{children:(0,d.Cl)(e.litros_entregados)})]},e.id)),!Z.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"text-slate-500 py-4",children:"Sin cargas en el per\xedodo."})})]})]})]})]})}]})})]})}},6809:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437);function n(e){let{color:t="slate",children:s}=e;return(0,a.jsx)("span",{className:"badge ".concat({slate:"bg-slate-100 text-slate-700",green:"bg-emerald-100 text-emerald-700",red:"bg-rose-100 text-rose-700",yellow:"bg-amber-100 text-amber-700",blue:"bg-sky-100 text-sky-700"}[t]),children:s})}s(2265)},9869:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),n=s(2265);function l(e){let{rows:t,columns:s,initialSortKey:l,initialSortDir:i="desc",onRowClick:r,rowClassName:d}=e,[c,o]=(0,n.useState)(l),[u,h]=(0,n.useState)(i),x=(0,n.useMemo)(()=>{if(!c)return t;let e=s.find(e=>e.key===c),a=[...t];return a.sort((t,s)=>{if(null==e?void 0:e.sort)return e.sort(t,s)*("asc"===u?1:-1);let a=t[c],n=s[c];return"number"==typeof a&&"number"==typeof n?(a-n)*("asc"===u?1:-1):String(null!=a?a:"").localeCompare(String(null!=n?n:""))*("asc"===u?1:-1)}),a},[t,s,c,u]),m=e=>{c===e?h("asc"===u?"desc":"asc"):(o(e),h("asc"))};return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{children:s.map(e=>(0,a.jsx)("th",{style:{width:e.width},onClick:()=>m(String(e.key)),className:"cursor-pointer select-none",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{children:e.header}),c===e.key?(0,a.jsx)("span",{className:"text-slate-400",children:"asc"===u?"▲":"▼"}):null]})},String(e.key)))})}),(0,a.jsx)("tbody",{children:x.map((e,t)=>{let n=!!r,l=(d?d(e):"")+" "+(n?"hover:bg-slate-50 cursor-pointer":"hover:bg-slate-50");return(0,a.jsx)("tr",{className:l.trim(),onClick:n?()=>r(e):void 0,onKeyDown:n?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),r(e))}:void 0,role:n?"button":void 0,tabIndex:n?0:-1,children:s.map(t=>{var s;return(0,a.jsx)("td",{className:"pr-4",children:t.render?t.render(e):String(null!==(s=e[t.key])&&void 0!==s?s:"")},String(t.key))})},t)})})]})})}},9725:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),n=s(2265);function l(e){let{open:t,onClose:s,title:l,children:i,width:r=520}=e;return((0,n.useEffect)(()=>{let e=e=>"Escape"===e.key&&s();return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),t)?(0,a.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/30",onClick:s}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 h-full bg-white shadow-xl",style:{width:r},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-200 p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:l}),(0,a.jsx)("button",{className:"btn",onClick:s,children:"Cerrar"})]}),(0,a.jsx)("div",{className:"h-[calc(100%-56px)] overflow-auto p-4",children:i})]})]}):null}},9617:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),n=s(2265);function l(e){var t,s;let{tabs:l,defaultTab:i}=e,[r,d]=(0,n.useState)(null!=i?i:null===(t=l[0])||void 0===t?void 0:t.key),c=null!==(s=l.find(e=>e.key===r))&&void 0!==s?s:l[0];return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"border-b border-slate-200",children:(0,a.jsx)("nav",{className:"flex gap-1",children:l.map(e=>{let t=e.key===r;return(0,a.jsxs)("button",{onClick:()=>d(e.key),className:"px-3 py-2 text-sm -mb-px border-b-2 transition-colors ".concat(t?"border-brand text-slate-900":"border-transparent text-slate-500 hover:text-slate-700"),children:[(0,a.jsx)("span",{children:e.label}),e.badge?(0,a.jsx)("span",{className:"ml-2",children:e.badge}):null]},e.key)})})}),(0,a.jsx)("div",{className:"py-4",children:null==c?void 0:c.content})]})}},8597:function(e,t,s){"use strict";s.d(t,{_g:function(){return i},hp:function(){return d},iG:function(){return l},rC:function(){return n},yH:function(){return a}});let a=[{id:"stn-a",name:"Estaci\xf3n A",active:!0,created_at:"2025-09-01T10:00:00Z"},{id:"stn-b",name:"Estaci\xf3n B",active:!0,created_at:"2025-09-10T10:00:00Z"},{id:"stn-c",name:"Estaci\xf3n C",active:!1,created_at:"2025-09-15T10:00:00Z"}],n=[{id:1,name:"Transporte L\xf3pez",enabled:!0,tries:0,locked_until:null,created_at:"2025-09-01T10:00:00Z"},{id:2,name:"Servicios \xc1guila",enabled:!1,tries:3,locked_until:"2025-10-21T12:00:00Z",created_at:"2025-09-05T10:00:00Z"},{id:3,name:"Obras Pampero",enabled:!0,tries:1,locked_until:null,created_at:"2025-09-08T10:00:00Z"}],l=[{id:101,pin_user_id:1,station_id:"stn-a",started_at:"2025-10-19T12:00:00Z",expires_at:"2025-10-19T15:00:00Z",max_liters:12e3,status:"active"},{id:102,pin_user_id:2,station_id:"stn-b",started_at:"2025-10-18T10:00:00Z",expires_at:"2025-10-18T12:00:00Z",max_liters:8e3,status:"expired"},{id:103,pin_user_id:3,station_id:"stn-a",started_at:"2025-10-17T11:00:00Z",expires_at:"2025-10-17T13:00:00Z",max_liters:6e3,status:"closed"}],i=[{id:9001,dispatch_id:2001,ts:"2025-10-19T12:31:00Z",camera_id:"cam-1",storage_path:"/photos/p1.jpg",meta:{angle:"front"}},{id:9002,dispatch_id:2001,ts:"2025-10-19T12:59:00Z",camera_id:"cam-1",storage_path:"/photos/p2.jpg",meta:{angle:"front"}},{id:9003,dispatch_id:2002,ts:"2025-10-18T09:40:00Z",camera_id:"cam-2",storage_path:"/photos/p3.jpg"}],r=[{id:7001,station_id:"stn-a",dispatch_id:2001,ts:"2025-10-19T12:30:00Z",state:"on",source:"controller"},{id:7002,station_id:"stn-a",dispatch_id:2001,ts:"2025-10-19T12:58:00Z",state:"off",source:"controller"},{id:7003,station_id:"stn-b",dispatch_id:2002,ts:"2025-10-18T09:20:00Z",state:"on"},{id:7004,station_id:"stn-b",dispatch_id:2002,ts:"2025-10-18T09:45:00Z",state:"off"}],d=[{id:2001,station_id:"stn-a",station_name:"Estaci\xf3n A",pin_user_id:1,user_name:"Transporte L\xf3pez",litros_autorizados:1e4,litros_entregados:9880,started_at:"2025-10-19T12:30:00Z",ended_at:"2025-10-19T13:05:00Z",status:"finished",source:"pin",notes:"patente: ABC123",photos:i.filter(e=>2001===e.dispatch_id),events:r.filter(e=>2001===e.dispatch_id)},{id:2002,station_id:"stn-b",station_name:"Estaci\xf3n B",pin_user_id:2,user_name:"Servicios \xc1guila",litros_autorizados:5e3,litros_entregados:3100,started_at:"2025-10-18T09:20:00Z",ended_at:"2025-10-18T09:45:00Z",status:"finished",source:"pin",notes:"patente: DEF456",photos:i.filter(e=>2002===e.dispatch_id),events:r.filter(e=>2002===e.dispatch_id)},{id:2003,station_id:"stn-a",station_name:"Estaci\xf3n A",pin_user_id:3,user_name:"Obras Pampero",litros_autorizados:12e3,litros_entregados:6200,started_at:"2025-10-19T10:10:00Z",ended_at:null,status:"running",source:"manual",notes:null,photos:[],events:[]}]},3448:function(e,t,s){"use strict";s.d(t,{Cl:function(){return n},G$:function(){return a}});let a=e=>{if(!e)return"—";let t=new Date(e);return isNaN(t.getTime())?"—":t.toLocaleString()},n=e=>e>=1e3?(e/1e3).toFixed(2)+" m\xb3":e.toFixed(0)+" L"}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5238)}),_N_E=e.O()}]);